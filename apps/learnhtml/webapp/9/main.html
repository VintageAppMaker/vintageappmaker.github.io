<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ìº”ë²„ìŠ¤ í™•ëŒ€/ì¶•ì†Œ + ì´ë™ + ë¸ŒëŸ¬ì‹œ ì§€ìš°ê¸°</title>
<style>
    body {
        font-family: sans-serif;
        margin: 0;
        padding: 0;
        height: 100vh;
        display: flex;
        flex-direction: column;
        overflow: hidden;
    }
    header {
        background-color: #4CAF50;
        color: white;
        padding: 15px;
        font-size: 1.2em;
        text-align: center;
        flex-shrink: 0;
    }
    #canvasContainer {
        flex: 1;
        position: relative;
        background-color: #ddd;
        overflow: hidden;
    }
    canvas {
        background-color: #fff;
        display: block;
        touch-action: none;
        transform-origin: 0 0;
    }
    /* ì¤Œ ì»¨íŠ¸ë¡¤ */
    .zoom-buttons {
        position: absolute;
        top: 10px;
        right: 10px;
        display: flex;
        flex-direction: column;
        gap: 5px;
        z-index: 20;
        align-items: center;
    }
    .zoom-buttons button {
        padding: 8px 10px;
        font-size: 16px;
        cursor: pointer;
        background: rgba(0,0,0,0.6);
        color: #fff;
        border: none;
        border-radius: 4px;
        user-select: none;
        min-width: 40px;
    }
    .zoom-level {
        background: transparent; /* âœ… ë°°ê²½ íˆ¬ëª… */
        color: #000;
        padding: 2px 6px;
        border-radius: 4px;
        font-size: 14px;
        margin-bottom: 5px;
        font-weight: bold;
        user-select: none;
    }
    /* í•˜ë‹¨ ì™¼ìª½ ì•„ì´ì½˜ ë²„íŠ¼ ì˜ì—­ */
    .left-controls {
        position: fixed;
        bottom: 10px;
        left: 10px;
        display: flex;
        gap: 10px;
        z-index: 50;
    }
    .left-controls button {
        width: 50px;
        height: 50px;
        font-size: 24px;
        background: rgba(0,0,0,0.6);
        color: white;
        border: none;
        border-radius: 50%;
        cursor: pointer;
    }
    /* ë°©í–¥ ë²„íŠ¼ ì»¨íŠ¸ë¡¤ëŸ¬ (ìš°ì¸¡ í•˜ë‹¨) */
    .move-controls {
        position: fixed;
        bottom: 10px;
        right: 10px;
        display: grid;
        grid-template-columns: 50px 50px 50px;
        grid-template-rows: 50px 50px 50px;
        gap: 5px;
        z-index: 40;
    }
    .move-controls button {
        background: rgba(0,0,0,0.6);
        color: #fff;
        border: none;
        border-radius: 4px;
        font-size: 20px;
        cursor: pointer;
    }
    .move-controls button:empty {
        background: transparent;
        cursor: default;
    }
</style>
</head>
<body>

<header>ë¬¸ì œ: 3x + 5 = 11, xì˜ ê°’ì„ êµ¬í•˜ì‹œì˜¤.</header>

<div id="canvasContainer">
    <canvas id="drawCanvas"></canvas>
    <div class="zoom-buttons">
        <div id="zoomLevel" class="zoom-level">100%</div>
        <button id="zoomIn">+</button>
        <button id="zoomOut">-</button>
        <button id="zoomReset">â†º</button> <!-- âœ… ì•„ì´ì½˜ ë²„íŠ¼ -->
    </div>
</div>

<!-- í•˜ë‹¨ ì™¼ìª½ ì•„ì´ì½˜ ë²„íŠ¼ -->
<div class="left-controls">
    <button id="toggleModeBtn" title="ì§€ìš°ê¸°/ì“°ê¸° ëª¨ë“œ">ğŸ©¹</button>
    <button id="saveBtn" title="ì €ì¥">ğŸ’¾</button>
</div>

<!-- ë°©í–¥ ë²„íŠ¼ (ìš°ì¸¡ í•˜ë‹¨) -->
<div class="move-controls">
    <button></button>
    <button id="moveUp">â–²</button>
    <button></button>
    <button id="moveLeft">â—€</button>
    <button></button>
    <button id="moveRight">â–¶</button>
    <button></button>
    <button id="moveDown">â–¼</button>
    <button></button>
</div>

<script>
const canvas = document.getElementById('drawCanvas');
const ctx = canvas.getContext('2d');
const zoomLevelDisplay = document.getElementById('zoomLevel');

let drawing = false;
let lastX, lastY;
let isErasing = false;
let scale = 1;
let translateX = 0, translateY = 0;
let lastDrawPos = { x: 0, y: 0 };

function initCanvas() {
    const width = window.innerWidth;
    const height = window.innerHeight - document.querySelector('header').offsetHeight - 20;
    canvas.width = width;
    canvas.height = height;
    ctx.fillStyle = "#fff";
    ctx.fillRect(0, 0, width, height);
}
initCanvas();

function updateTransform() {
    canvas.style.transformOrigin = `${lastDrawPos.x}px ${lastDrawPos.y}px`;
    canvas.style.transform = `translate(${translateX}px, ${translateY}px) scale(${scale})`;
}

function updateZoomDisplay() {
    zoomLevelDisplay.innerText = `${Math.round(scale * 100)}%`;
}

function getXY(e) {
    let clientX, clientY;
    if (e.touches) {
        clientX = e.touches[0].clientX;
        clientY = e.touches[0].clientY;
    } else {
        clientX = e.clientX;
        clientY = e.clientY;
    }
    const rect = canvas.getBoundingClientRect();
    return {
        x: (clientX - rect.left) / scale,
        y: (clientY - rect.top) / scale
    };
}

function startDraw(e) {
    e.preventDefault();
    drawing = true;
    const {x, y} = getXY(e);
    lastX = x;
    lastY = y;
    lastDrawPos = { x, y };
}
function draw(e) {
    if (!drawing) return;
    e.preventDefault();
    const {x, y} = getXY(e);

    ctx.beginPath();
    ctx.moveTo(lastX, lastY);
    ctx.lineTo(x, y);

    ctx.strokeStyle = isErasing ? "#fff" : "#000";
    ctx.lineWidth = isErasing ? 20 : 2;
    ctx.lineCap = "round";
    ctx.stroke();

    lastX = x;
    lastY = y;
    lastDrawPos = { x, y };
}
function endDraw() {
    drawing = false;
}

document.getElementById('toggleModeBtn').addEventListener('click', () => {
    isErasing = !isErasing;
    document.getElementById('toggleModeBtn').innerText = isErasing ? "âœï¸" : "ğŸ©¹";
});

document.getElementById('saveBtn').addEventListener('click', () => {
    const link = document.createElement('a');
    link.download = 'math_solution.jpg';
    link.href = canvas.toDataURL('image/jpeg', 0.9);
    link.click();
});

function zoom(factor) {
    scale *= factor;
    if (scale < 0.3) scale = 0.3;
    if (scale > 5) scale = 5;
    updateTransform();
    updateZoomDisplay();
}

document.getElementById('zoomIn').addEventListener('click', () => zoom(1.3));
document.getElementById('zoomOut').addEventListener('click', () => zoom(1/1.3));
document.getElementById('zoomReset').addEventListener('click', () => {
    scale = 1;
    translateX = 0;
    translateY = 0;
    updateTransform();
    updateZoomDisplay();
});

function moveCanvas(dx, dy) {
    if (scale > 1) {
        translateX += dx;
        translateY += dy;
        updateTransform();
    }
}
document.getElementById('moveUp').addEventListener('click', () => moveCanvas(0, -50));
document.getElementById('moveDown').addEventListener('click', () => moveCanvas(0, 50));
document.getElementById('moveLeft').addEventListener('click', () => moveCanvas(-50, 0));
document.getElementById('moveRight').addEventListener('click', () => moveCanvas(50, 0));

canvas.addEventListener('mousedown', startDraw);
canvas.addEventListener('mousemove', draw);
canvas.addEventListener('mouseup', endDraw);
canvas.addEventListener('mouseleave', endDraw);
canvas.addEventListener('touchstart', startDraw, {passive:false});
canvas.addEventListener('touchmove', draw, {passive:false});
canvas.addEventListener('touchend', endDraw);

updateZoomDisplay();
updateTransform();
</script>
</body>
</html>
