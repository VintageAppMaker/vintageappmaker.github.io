<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>2000px 캔버스 + 버튼 스크롤 + 브러시 지우기</title>
<style>
    body {
        font-family: sans-serif;
        margin: 0;
        padding: 0;
        height: 100vh;
        display: flex;
        flex-direction: column;
        overflow: hidden;
    }
    header {
        background-color: #4CAF50;
        color: white;
        padding: 15px;
        font-size: 1.2em;
        text-align: center;
        flex-shrink: 0;
    }
    #canvasContainer {
        flex: 1;
        position: relative;
        background-color: #ddd;
        overflow: hidden;
    }
    #canvasWrapper {
        height: 100%;
        overflow-y: scroll; /* ✅ 항상 스크롤바 표시 */
        overflow-x: hidden;
        -webkit-overflow-scrolling: touch;
    }
    canvas {
        background-color: #fff;
        display: block;
        touch-action: none;
        max-width: 100%;
    }
    /* 스크롤 버튼 */
    .scroll-buttons {
        position: absolute;
        top: 10px;
        right: 10px;
        display: flex;
        flex-direction: column;
        gap: 5px;
        z-index: 20;
    }
    .scroll-buttons button {
        padding: 8px 10px;
        font-size: 16px;
        cursor: pointer;
        background: rgba(0,0,0,0.6);
        color: #fff;
        border: none;
        border-radius: 4px;
        user-select: none;
    }
    /* 하단 버튼 고정 */
    footer {
        position: fixed;
        bottom: 0;
        left: 0;
        width: 100%;
        padding: 10px;
        text-align: center;
        background-color: #f1f1f1;
        z-index: 30;
    }
    footer button {
        padding: 10px 15px;
        font-size: 1em;
        margin: 0 5px;
    }
</style>
</head>
<body>

<header>문제: 3x + 5 = 11, x의 값을 구하시오.</header>

<div id="canvasContainer">
    <div id="canvasWrapper">
        <canvas id="drawCanvas"></canvas>
    </div>
    <div class="scroll-buttons">
        <button id="scrollUp">▲</button>
        <button id="scrollDown">▼</button>
    </div>
</div>

<footer>
    <button id="toggleModeBtn">지우기 모드</button>
    <button id="saveBtn">저장(JPG)</button>
</footer>

<script>
const canvas = document.getElementById('drawCanvas');
const ctx = canvas.getContext('2d');
const wrapper = document.getElementById('canvasWrapper');

let drawing = false;
let lastX, lastY;
let isErasing = false; // ✅ 현재 모드 상태 (false=쓰기, true=지우기)

// ✅ 캔버스 고정 크기 (2000px)
function initCanvas() {
    const width = wrapper.clientWidth;
    const height = 2000;
    canvas.width = width;
    canvas.height = height;
    canvas.style.width = width + "px";
    canvas.style.height = height + "px";
    ctx.fillStyle = "#fff";
    ctx.fillRect(0, 0, width, height);
}
initCanvas();

// 좌표 계산
function getXY(e) {
    const wrapperRect = wrapper.getBoundingClientRect();
    let clientX, clientY;
    if (e.touches) {
        clientX = e.touches[0].clientX;
        clientY = e.touches[0].clientY;
    } else {
        clientX = e.clientX;
        clientY = e.clientY;
    }
    return {
        x: clientX - wrapperRect.left,
        y: clientY - wrapperRect.top + wrapper.scrollTop
    };
}

// 드로잉
function startDraw(e) {
    e.preventDefault();
    drawing = true;
    const {x, y} = getXY(e);
    lastX = x;
    lastY = y;
}
function draw(e) {
    if (!drawing) return;
    e.preventDefault();
    const {x, y} = getXY(e);

    ctx.beginPath();
    ctx.moveTo(lastX, lastY);
    ctx.lineTo(x, y);

    ctx.strokeStyle = isErasing ? "#fff" : "#000"; // ✅ 모드에 따른 색상 변경
    ctx.lineWidth = isErasing ? 20 : 2; // 지우기 모드일 때 굵게
    ctx.lineCap = "round";
    ctx.stroke();

    lastX = x;
    lastY = y;
}
function endDraw() {
    drawing = false;
}

// 이벤트 등록
canvas.addEventListener('mousedown', startDraw);
canvas.addEventListener('mousemove', draw);
canvas.addEventListener('mouseup', endDraw);
canvas.addEventListener('mouseleave', endDraw);
canvas.addEventListener('touchstart', startDraw, {passive:false});
canvas.addEventListener('touchmove', draw, {passive:false});
canvas.addEventListener('touchend', endDraw);

// ✅ 모드 토글 버튼
document.getElementById('toggleModeBtn').addEventListener('click', () => {
    isErasing = !isErasing;
    document.getElementById('toggleModeBtn').innerText = isErasing ? "쓰기 모드" : "지우기 모드";
});

// 저장
document.getElementById('saveBtn').addEventListener('click', () => {
    const link = document.createElement('a');
    link.download = 'math_solution.jpg';
    link.href = canvas.toDataURL('image/jpeg', 0.9);
    link.click();
});

// ✅ 스크롤 버튼 (길게 누르면 계속 이동)
let scrollInterval;
function startScroll(direction) {
    stopScroll();
    scrollInterval = setInterval(() => {
        wrapper.scrollBy({ top: direction * 20, behavior: 'auto' });
    }, 30);
}
function stopScroll() {
    clearInterval(scrollInterval);
}

document.getElementById('scrollUp').addEventListener('mousedown', () => startScroll(-1));
document.getElementById('scrollUp').addEventListener('mouseup', stopScroll);
document.getElementById('scrollUp').addEventListener('mouseleave', stopScroll);
document.getElementById('scrollUp').addEventListener('touchstart', () => startScroll(-1), {passive:true});
document.getElementById('scrollUp').addEventListener('touchend', stopScroll);

document.getElementById('scrollDown').addEventListener('mousedown', () => startScroll(1));
document.getElementById('scrollDown').addEventListener('mouseup', stopScroll);
document.getElementById('scrollDown').addEventListener('mouseleave', stopScroll);
document.getElementById('scrollDown').addEventListener('touchstart', () => startScroll(1), {passive:true});
document.getElementById('scrollDown').addEventListener('touchend', stopScroll);
</script>

</body>
</html>
